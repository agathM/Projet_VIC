performance.mark("js-parse-end:40235-af61887fbb6d.js");
"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([[40235],{11418:(e,t,r)=>{let n;r.d(t,{H:()=>q});var s=r(35750),i=r(18150),a=r(85242),o=r(88243),l=r(16213),u=r(10204),c=new WeakMap,h=new WeakSet;let AliveSession=class AliveSession extends u.ib{constructor(e,t,r,n,s){super(e,()=>(0,o._)(this,h,d).call(this),r,n,void 0,s),(0,l._)(this,h),(0,i._)(this,c,{writable:!0,value:void 0}),(0,a._)(this,c,t)}};function d(){return f((0,s._)(this,c))}async function f(e){let t=await b(e);return t&&t.url&&t.token?w(t.url,t.token):null}async function b(e){let t=await fetch(e,{headers:{Accept:"application/json"}});if(t.ok)return t.json();if(404===t.status)return null;throw Error("fetch error")}async function w(e,t){let r=await fetch(e,{method:"POST",mode:"same-origin",headers:{"Scoped-CSRF-Token":t}});if(r.ok)return r.text();throw Error("fetch error")}var p=r(70170),m=r(34095),_=r(82075),v=r(23683);function g(e,{channel:t,type:r,data:n}){for(let s of e)s.dispatchEvent(new CustomEvent(`socket:${r}`,{bubbles:!1,cancelable:!1,detail:{name:t,data:n}}))}var k=new WeakMap,y=new WeakMap,M=new WeakMap,A=new WeakMap,S=new WeakMap,E=new WeakSet;let P=class AliveSessionProxy{subscribe(e){let t=(0,s._)(this,y).add(...e);t.length&&(0,s._)(this,k).port.postMessage({subscribe:t});let r=new Set(t.map(e=>e.name)),n=e.reduce((e,t)=>{let n=t.topic.name;return(0,u.JR)(n)&&!r.has(n)&&e.add(n),e},new Set);n.size&&(0,s._)(this,k).port.postMessage({requestPresence:Array.from(n)})}unsubscribeAll(...e){let t=(0,s._)(this,y).drain(...e);t.length&&(0,s._)(this,k).port.postMessage({unsubscribe:t});let r=(0,s._)(this,M).removeSubscribers(e);this.sendPresenceMetadataUpdate(r)}updatePresenceMetadata(e){let t=new Set;for(let r of e)(0,s._)(this,M).setMetadata(r),t.add(r.channelName);this.sendPresenceMetadataUpdate(t)}sendPresenceMetadataUpdate(e){if(!e.size)return;let t=[];for(let r of e)t.push({channelName:r,metadata:(0,s._)(this,M).getChannelMetadata(r)});(0,s._)(this,k).port.postMessage({updatePresenceMetadata:t})}online(){(0,s._)(this,k).port.postMessage({online:!0})}offline(){(0,s._)(this,k).port.postMessage({online:!1})}hangup(){(0,s._)(this,k).port.postMessage({hangup:!0})}constructor(e,t,r,n,c,h){(0,l._)(this,E),(0,i._)(this,k,{writable:!0,value:void 0}),(0,i._)(this,y,{writable:!0,value:new u.m0}),(0,i._)(this,M,{writable:!0,value:new u.VH}),(0,i._)(this,A,{writable:!0,value:void 0}),(0,i._)(this,S,{writable:!0,value:new Map}),(0,a._)(this,A,c),(0,a._)(this,k,new SharedWorker(`${e}?module=true`,{name:`github-socket-worker-v3-${n}`,type:"module"})),(0,s._)(this,k).port.onmessage=({data:e})=>(0,o._)(this,E,T).call(this,e),(0,s._)(this,k).port.postMessage({connect:{url:t,refreshUrl:r,options:h}})}};function T(e){let{channel:t}=e;if("presence"===e.type){let r=(0,s._)(this,S).get(t);r||(r=(0,p.s)((e,r)=>{(0,s._)(this,A).call(this,e,r),(0,s._)(this,S).delete(t)},100),(0,s._)(this,S).set(t,r)),r((0,s._)(this,y).subscribers(t),e);return}(0,s._)(this,A).call(this,(0,s._)(this,y).subscribers(t),e)}async function W(){let e,t=(e=document.head.querySelector("link[rel=shared-web-socket-src]")?.getAttribute("href"))&&e.startsWith("/")?e:null;if(!t)return;let r=document.head.querySelector("link[rel=shared-web-socket]")?.href??null;if(!r)return;let n=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-refresh-url")??null;if(!n)return;let s=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-session-id")??null;if(!s)return;let i=(()=>{let e={};if(!(0,v.nr)()&&"SharedWorker"in window&&"true"!==(0,_.A)("localStorage").getItem("bypassSharedWorker"))try{return new P(t,r,n,s,g,e)}catch{}return new AliveSession(r,n,!1,g,e)})();return window.addEventListener("online",()=>i.online()),window.addEventListener("offline",()=>i.offline()),window.addEventListener("pagehide",()=>{"hangup"in i&&i.hangup()}),i}async function C(){return await m.G,W()}function q(){return n||(n=C())}},33303:(e,t,r)=>{function n(){return Promise.resolve()}function s(){return new Promise(window.requestAnimationFrame)}async function i(e,t){let r,n=new Promise(t=>{r=self.setTimeout(t,e)});if(!t)return n;try{var s;await Promise.race([n,(s=t,new Promise((e,t)=>{let r=Error("aborted");r.name="AbortError",s.aborted?t(r):s.addEventListener("abort",()=>t(r))}))])}catch(e){throw self.clearTimeout(r),e}}function a(e){let t=[];return function(r){t.push(r),1===t.length&&queueMicrotask(()=>{let r=t.slice(0);t.length=0,e(r)})}}r.d(t,{G$:()=>s,k2:()=>n,rK:()=>a,uk:()=>i})},40235:(e,t,r)=>{r.d(t,{x:()=>b});var n,s=r(96540),i=r(70263),a=r(11418),o=r(73056),l=r(74848),u=r(16522),c=r(10204);let h=(0,s.createContext)(null),d=null;function f(e,t){let r=c.KK.parse(e);if(!r)throw Error(`Invalid channel name. Did you forget to sign it with \`signChannel("${e}")\`?`);return d||(d=new c.m0),d.add({topic:r,subscriber:t}),{unsubscribe:()=>{d?.delete({topic:r,subscriber:t})}}}try{h.displayName||(h.displayName="AliveTestContext")}catch{}try{(n=function(e){let t,r,n=(0,u.c)(4),{children:i,initialMessages:a}=e;return n[0]!==a?(t=()=>{let e=[];if(a)for(let[t,r]of a){let n=window.setTimeout(()=>{var e=t,n=r;if(null===d)throw Error('Test helper `dispatchAliveTestMessage` called outside `AliveTestProvider`. Please wrap your component under test in `AliveTestProvider` from "@github-ui/use-alive/test-utils".');for(let t of Array.from(d.subscribers(e)))t(n)},0);e.push(n)}return()=>{for(let t of(d=null,e))window.clearTimeout(t)}},n[0]=a,n[1]=t):t=n[1],(0,s.useEffect)(t),n[2]!==i?(r=(0,l.jsx)(h,{value:f,children:i}),n[2]=i,n[3]=r):r=n[3],r}).displayName||(n.displayName="AliveTestProvider")}catch{}function b(e,t){let r=(0,i.A)(),n=(0,s.use)(h);(0,s.useEffect)(()=>{let s=()=>{},i=!1;return async function(){if(e){if("function"==typeof n){let r=await n(e,t);r&&(s=r.unsubscribe);return}try{let n=await (0,a.H)();if(i)return;let l=(0,o.$)(n,e,t);l?.unsubscribe&&(r()?s=l.unsubscribe:l.unsubscribe())}catch(e){console.error(e)}}}(),()=>{i=!0,s()}},[e,t,r,n])}},70263:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(16522),s=r(96540);function i(){let e,t,r,i=(0,n.c)(3),a=(0,s.useRef)(!1);i[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>a.current,i[0]=e):e=i[0];let o=e;return i[1]===Symbol.for("react.memo_cache_sentinel")?(t=()=>(a.current=!0,()=>{a.current=!1}),r=[],i[1]=t,i[2]=r):(t=i[1],r=i[2]),(0,s.useLayoutEffect)(t,r),o}},73056:(e,t,r)=>{r.d(t,{$:()=>a});var n=r(10204),s=r(33303);let i=new WeakMap;function a(e,t,r){let a;if(!e)throw Error("Not connected to alive");if(!t)throw Error("No channel name");let o=n.KK.parse(t);if(!o)throw Error("Invalid channel name");let l={subscriber:{dispatchEvent:e=>{e instanceof CustomEvent&&r(e.detail.data)}},topic:o},u=((a=i.get(e))||(a={subscribe:(0,s.rK)(t=>e.subscribe(t.flat())),unsubscribeAll:(0,s.rK)(t=>e.unsubscribeAll(...t))},i.set(e,a)),a);return u.subscribe([l]),{unsubscribe:()=>u.unsubscribeAll(l.subscriber)}}}}]);
//# sourceMappingURL=40235-0433e9264841.js.map